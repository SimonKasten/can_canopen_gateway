$("#interfaces").change(function () {
    $("#NI-CAN,#PCAN,#CANCase").hide();
    if ($(this).val() == "PCAN") {
      $("#PCAN").show();
    }
    else {
      $("#CANCase").show();
    }
});

$("#canset").click(function () {
    var xmlHttp = new XMLHttpRequest();
    var iface = document.getElementById("interfaces").value;
    var bus;
    if (iface == "PCAN") {
      bus = document.getElementById("PCAN-options").value;
    }
    else if (iface == "CANCase") {
      bus = document.getElementById("CANCase-options").value;
    }
    var nodes = document.getElementById("nodes").value;
    var mot1 = document.getElementById("motor1").value;
    var mot2 = document.getElementById("motor2").value;

    var motor1_on = document.getElementById("motor1_on").checked;
    var motor2_on = document.getElementById("motor2_on").checked;

    xmlHttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
          var input = JSON.parse(this.responseText);
          console.log(input);
          if (input.hasOwnProperty("success") && input.hasOwnProperty("errorMsg")){
            document.getElementById("errorField").innerHTML = input["errorMsg"];
            s = input["success"];
              if (s == 1) { // Success
                  document.getElementById("led1").style.backgroundColor = "green";
              }
              else if (s == 0 || s == null) { // no success
                  document.getElementById("led1").style.backgroundColor = "orange";
              }
              else if (s == -1) { // Error
                document.getElementById("led1").style.backgroundColor = "red";
              }
              else {
                document.getElementById("errorField").innerHTML = "...";
              }
          }
      }
    };

    xmlHttp.open("POST", "setInterface" + "&iface=" + iface
                  + "&bus=" + bus
                  + "&nodes=" + nodes
                  + "&motor1=" + mot1
                  + "&motor2=" + mot2
                  + "&using_mot1=" + motor1_on
                  + "&using_mot2=" + motor2_on
                  , true);
    xmlHttp.send(null);
});
